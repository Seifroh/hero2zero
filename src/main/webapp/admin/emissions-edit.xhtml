<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Admin · Emissionsdaten pflegen</title>
    </h:head>
    <h:body>
        <h:form id="adminForm">

            <!-- Growl für Feedback -->
            <p:growl id="messages" showDetail="true" showSummary="false"/>

            <p:dataTable id="dataTable"
                         widgetVar="adminTable"
                         value="#{emissionsAdminBean.allEmissions}"
                         var="e"
                         editable="true" editMode="cell"
                         paginator="true" rows="20"
                         filterEvent="keyup" filterDelay="300"
                         style="width:100%">

                <p:column headerText="ID" style="width:10%">
                    #{e.id}
                </p:column>

                <p:column headerText="Land"
                          filterBy="#{e.country}"
                          filterMatchMode="contains"
                          style="width:20%">
                    #{e.country}
                </p:column>

                <p:column headerText="Code"
                          filterBy="#{e.countryCode}"
                          filterMatchMode="contains"
                          style="width:15%">
                    #{e.countryCode}
                </p:column>

                <p:column headerText="Jahr"
                          filterBy="#{e.year}"
                          filterMatchMode="equals"
                          style="width:15%">
                    #{e.year}
                </p:column>

                <p:column headerText="CO₂ (kt)"
                          filterBy="#{e.co2Emissions}"
                          filterFunction="#{filterUtil.co2Filter}"
                          style="width:15%">
                    <f:facet name="filter">
                        <p:inputText placeholder="CO₂"
                                     style="width:100%"
                                     onkeyup="PF('adminTable').filter()"/>
                    </f:facet>
                    <p:cellEditor>
                        <f:facet name="output">#{e.co2Emissions}</f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{e.co2Emissions}" style="width:100%"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:ajax event="cellEdit"
                        listener="#{emissionsAdminBean.onCellEdit}"
                        update=":adminForm:messages"/>

                <p:column headerText="Freigabe" style="width:15%">
                    <h:panelGroup>
                        <h:outputText value="Ja" rendered="#{e.approved}"/>
                        <p:commandButton value="Freigeben"
                                         icon="pi pi-check"
                                         action="#{emissionsAdminBean.approve(e)}"
                                         update=":adminForm:dataTable :adminForm:messages"
                                         rendered="#{!e.approved}"
                                         styleClass="ui-button-sm"/>
                    </h:panelGroup>
                </p:column>
            </p:dataTable>

            <p:commandButton value="Neuer Eintrag"
                             icon="pi pi-plus"
                             oncomplete="PF('newDlg').show()"
                             process="@this"/>

            <p:dialog header="Neue Emission"
                      widgetVar="newDlg"
                      modal="true"
                      closable="true"
                      resizable="false">
                <h:panelGrid columns="2" cellpadding="5">
                    <h:outputLabel for="country" value="Land:"/>
                    <p:inputText id="country"
                                 value="#{emissionsAdminBean.newEmission.country}"
                                 required="true"/>

                    <h:outputLabel for="code" value="Code:"/>
                    <p:inputText id="code"
                                 value="#{emissionsAdminBean.newEmission.countryCode}"
                                 required="true"/>

                    <h:outputLabel for="year" value="Jahr:"/>
                    <p:inputText id="year"
                                 value="#{emissionsAdminBean.newEmission.year}"
                                 required="true"
                                 maxlength="4"/>

                    <h:outputLabel for="co2" value="CO₂ (kt):"/>
                    <p:inputText id="co2"
                                 value="#{emissionsAdminBean.newEmission.co2Emissions}"/>
                </h:panelGrid>

                <p:commandButton value="Speichern"
                                 action="#{emissionsAdminBean.saveNew}"
                                 process="@form"
                                 update=":adminForm:dataTable :adminForm:messages"
                                 oncomplete="PF('newDlg').hide()"/>
            </p:dialog>
        </h:form>
    </h:body>
</html>
