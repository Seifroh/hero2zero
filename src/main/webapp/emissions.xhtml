<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
    <h:head>
        <meta charset="UTF-8"/>
        <title>Like Hero to Zero | CO₂-Emissionen</title>
        <!-- Theme laden -->
        <h:outputStylesheet library="luna-blue" name="theme.css"/>
    </h:head>
    <h:body>
        <!-- HEADER -->
        <p:toolbar style="background-color:#f7f2e8; padding:0.5em;">
            <!-- Links: Logo + Titel -->
            <p:toolbarGroup align="left" style="display:flex; align-items:center; gap:0.5em">
                <h:graphicImage library="images"
                                name="logo.png"
                                alt="Hero2Zero Logo"
                                height="80"/>
                <h:outputText value="Like Hero to Zero"
                              style="font-weight:bold; font-size:1.5em; color:#333"/>
            </p:toolbarGroup>

            <!-- Rechts: Login/Logout + Navigation -->
            <p:toolbarGroup align="right" style="display:flex; align-items:center; gap:1em">
                <!-- Login-Button, wenn nicht eingeloggt -->
                <h:panelGroup rendered="#{!loginBean.loggedIn}">
                    <p:button value="Login"
                              icon="pi pi-sign-in"
                              outcome="login"
                              styleClass="ui-button-sm"/>
                </h:panelGroup>

                <!-- Benutzername + Logout, wenn angemeldet -->
                <h:panelGroup rendered="#{loginBean.loggedIn}"
                              style="display:flex; align-items:center; gap:0.5em">

                    <h:outputText value="Angemeldet als #{facesContext.externalContext.userPrincipal.name}"
                                  style="color:#333; font-style:italic;"/>

                    <!-- Mini-Form nur für den Button -->
                    <h:form prependId="false" style="display:inline">
                        <p:commandButton value="Logout"
                                         icon="pi pi-sign-out"
                                         action="#{loginBean.logout()}"
                                         ajax="false"
                                         styleClass="ui-button-sm"/>
                    </h:form>
                </h:panelGroup>

                <p:button value="Home"
                          icon="pi pi-home"
                          outcome="emissions"
                          styleClass="ui-button-sm"/>
                <p:button value="Impressum"
                          icon="pi pi-info-circle"
                          onclick="PF('impressumDlg').show();return false;"
                          styleClass="ui-button-sm"/>
            </p:toolbarGroup>
        </p:toolbar>

        <h:outputText value="loginBean.loggedIn=#{loginBean.loggedIn}" 
                      style="color:red; font-weight:bold; margin-left:1em"/>

        <!-- Impressum-Dialog -->
        <p:dialog header="Hinweis" widgetVar="impressumDlg"
                  modal="true" closable="true"
                  draggable="false" resizable="false">
            <h:outputText value="Uniprojekt – kein formelles Impressum notwendig."/>
        </p:dialog>

        <h:form id="emissionsForm">
            <p:growl id="messages" showDetail="true" showSummary="false"/>

            <p:dataTable id="dataTable"
                         widgetVar="dt"
                         value="#{emissionBean.allEmissions}"
                         var="e"
                         paginator="true" rows="20"
                         filterEvent="keyup" filterDelay="300"
                         currentPageReportTemplate="Einträge gesamt: {totalRecords}"
                         styleClass="p-datatable-sm"
                         style="width:100%;"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                         emptyMessage="Keine Einträge gefunden.">

                <p:column headerText="Land"
                          filterBy="#{e.country}"
                          filterMatchMode="contains"
                          style="width:25%">
                    <f:facet name="filter">
                        <p:inputText style="width:100%"
                                     placeholder="Land"
                                     onkeyup="if (this.checkValidity()) {
                                                 PF('dt').filter();
                                             } else {
                                                 this.reportValidity();
                                             }"
                                     pt:pattern="[A-Za-zÄÖÜäöüß ]+"
                                     pt:title="Nur Buchstaben erlaubt"/>
                    </f:facet>
                    #{e.country}
                </p:column>

                <p:column headerText="Code"
                          filterBy="#{e.countryCode}"
                          filterMatchMode="contains"
                          style="width:25%">
                    <f:facet name="filter">
                        <p:inputText style="width:100%"
                                     placeholder="Code"
                                     onkeyup="if (this.checkValidity()) {
                                                 PF('dt').filter();
                                             } else {
                                                 this.reportValidity();
                                             }"
                                     pt:pattern="[A-Za-z]{1,3}"
                                     pt:title="Bis zu 3 Buchstaben"/>
                    </f:facet>
                    #{e.countryCode}
                </p:column>

                <p:column headerText="Jahr"
                          filterBy="#{e.year}"
                          filterMatchMode="equals"
                          style="width:25%">
                    <f:facet name="filter">
                        <p:inputText style="width:100%"
                                     placeholder="Jahr"
                                     maxlength="4"
                                     onkeyup="if (this.checkValidity()) {
                                                 PF('dt').filter();
                                             } else {
                                                 this.reportValidity();
                                             }"
                                     pt:pattern="\d{4}"
                                     pt:title="Vier Ziffern erforderlich"/>
                    </f:facet>
                    #{e.year}
                </p:column>

                <p:column headerText="CO₂ (kt)"
                          filterBy="#{e.co2Emissions}"
                          filterMatchMode="equals"
                          style="width:25%">
                    <f:facet name="filter">
                        <p:inputText style="width:100%"
                                     placeholder="0.1234"
                                     onkeyup="if (this.checkValidity()) {
                                                 PF('dt').filter();
                                             } else {
                                                 this.reportValidity();
                                             }"
                                     pt:pattern="\d+(\.\d{1,4})?"
                                     pt:title="Zahl mit bis zu 4 Nachkommastellen (z. B. 1.2023)"/>
                    </f:facet>
                    #{e.co2Emissions}
                </p:column>

            </p:dataTable>
        </h:form>

        <h:panelGroup layout="block"
                      style="text-align:center; padding:0.5em; background:#f7f2e8">
            <h:outputText value="Modul: IPWA02-01 Programmierung von industriellen Informationssystemen mit Java EE"
                          style="font-weight:bold"/>
        </h:panelGroup>

    </h:body>
</html>