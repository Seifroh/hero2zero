<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
    <h:head>
        <meta charset="UTF-8"/>
        <title>Like Hero to Zero | CO₂-Emissionen</title>
        <h:outputStylesheet library="nova-light" name="theme.css"/>
    </h:head>
    <h:body>
        <p:toolbar style="background-color:#f7f2e8; padding:0.5em;">
            <p:toolbarGroup align="left" style="display:flex; align-items:center; gap:0.5em">
                <h:graphicImage library="images"
                                name="logo.png"
                                alt="Hero2Zero Logo"
                                height="80"/>
                <h:outputText value="Like Hero to Zero"
                              style="font-weight:bold; font-size:1.5em; color:#333"/>
            </p:toolbarGroup>

            <!-- Rechte Toolbar: nur Buttons -->
            <p:toolbarGroup align="right" style="display:flex; flex-wrap:wrap; align-items:center; justify-content:flex-end; gap:0.5em">

                <h:panelGroup rendered="#{!loginBean.loggedIn}">
                    <p:button value="Login"
                              icon="pi pi-sign-in"
                              outcome="login"
                              styleClass="ui-button-sm"/>
                </h:panelGroup>

                <h:panelGroup rendered="#{loginBean.loggedIn}">
                    <p:button value="Datenpflege"
                              icon="pi pi-database"
                              outcome="/admin/emissions-edit.xhtml"
                              styleClass="ui-button-sm"/>

                    <h:form prependId="false" style="display:inline">
                        <p:commandButton value="Logout"
                                         icon="pi pi-sign-out"
                                         action="#{loginBean.logout()}"
                                         ajax="false"
                                         styleClass="ui-button-sm"/>
                    </h:form>
                </h:panelGroup>

                <p:button value="Home"
                          icon="pi pi-home"
                          outcome="emissions"
                          styleClass="ui-button-sm"/>

                <p:button value="Impressum"
                          icon="pi pi-info-circle"
                          onclick="PF('impressumDlg').show();return false;"
                          styleClass="ui-button-sm"/>
            </p:toolbarGroup>
        </p:toolbar>
        <!-- Loginstatus darunter -->
        <h:panelGroup rendered="#{loginBean.loggedIn}" layout="block"
                      style="text-align:right; padding:0 1em 0.5em 1em;">
            <h:outputText value="Angemeldet als #{facesContext.externalContext.userPrincipal.name}"
                          style="color:#333; font-style:italic;"/>
        </h:panelGroup>

         <!-- <h:outputText value="TEST: #{filterUtil != null ? 'Bean geladen' : 'Bean NICHT geladen'}" style="color:red"/>

        <h:outputText value="loginBean.loggedIn=#{loginBean.loggedIn}" 
                      style="color:red; font-weight:bold; margin-left:1em"/> -->

        <p:dialog header="Hinweis" widgetVar="impressumDlg"
                  modal="true" closable="true"
                  draggable="false" resizable="false">
            <h:outputText value="Uniprojekt – kein formelles Impressum notwendig."/>
        </p:dialog>

        <h:form id="emissionsForm">
            <p:growl id="messages" showDetail="true" showSummary="false"/>

            <h:panelGroup layout="block" style="margin:1em 0;">
                <h:outputText value="Über die Filterfelder in der Tabelle können Sie gezielt nach Ländern, 
                              Ländercodes, Jahren oder CO₂-Werten suchen. Nachkommastellen bitte mit Punkt eingeben (z. B. 0.1)." 
                              style="color:#555;"/>
            </h:panelGroup>

            <p:dataTable id="dataTable"
                         widgetVar="dataTable"
                         value="#{emissionBean.allEmissionsApproved}"
                         var="e"
                         paginator="true" rows="15"
                         filterEvent="keyup" filterDelay="200"
                         currentPageReportTemplate="Einträge gesamt: {totalRecords}"
                         styleClass="p-datatable-sm"
                         style="width:100%;"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                         emptyMessage="Keine Einträge gefunden.">

                <p:column headerText="Land"
                          filterBy="#{e.country}"
                          filterMatchMode="contains"
                          style="width:25%">
                    <f:facet name="filter">
                        <p:inputText style="width:100%"
                                     placeholder="Land"
                                     maxlength="50"
                                     onkeyup="if (this.checkValidity()) {
                                                 PF('dataTable').filter();
                                             } else {
                                                 this.reportValidity();
                                             }"
                                     pt:pattern="[A-Za-zÄÖÜäöüß ]+"
                                     pt:title="Nur Buchstaben erlaubt, auch Umlaute. Maximal 50 Zeichen."/>
                    </f:facet>
                    #{e.country}
                </p:column>

                <p:column headerText="Code"
                          filterBy="#{e.countryCode}"
                          filterMatchMode="contains"
                          style="width:25%">
                    <f:facet name="filter">
                        <p:inputText style="width:100%"
                                     placeholder="Code"
                                     maxlength="3"
                                     onkeyup="if (this.checkValidity()) {
                                                 PF('dataTable').filter();
                                             } else {
                                                 this.reportValidity();
                                             }"
                                     pt:pattern="[A-Za-z]{1,3}"
                                     pt:title="Bis zu 3 Buchstaben. Keine Umlaute erlaubt."/>
                    </f:facet>
                    #{e.countryCode}
                </p:column>

                <p:column headerText="Jahr"
                          filterBy="#{e.year}"
                          filterMatchMode="equals"
                          style="width:25%">
                    <f:facet name="filter">
                        <p:inputText style="width:100%"
                                     placeholder="Jahr"
                                     maxlength="4"
                                     onkeyup="if (this.checkValidity()) {
                                                 PF('dataTable').filter();
                                             } else {
                                                 this.reportValidity();
                                             }"
                                     pt:pattern="\d{4}"
                                     pt:title="Vier Zahlen erforderlich, z.B. 1950."/>
                    </f:facet>
                    #{e.year}
                </p:column>

                <p:column headerText="CO₂ (kt)"
                          filterBy="#{e.co2Emissions}"
                          filterFunction="#{emissionBean.co2Filter}"
                          style="width:15%">
                    <f:facet name="filter">
                        <p:inputText placeholder="CO₂"
                                     maxlength="12"
                                     style="width:100%"
                                     onkeyup="PF('dataTable').filter()"
                                     pt:pattern="\d+(\.\d+)?"
                                     pt:title="Nur Zahlen erlaubt. Nachkommastellen bitte mit Punkt schreiben (z.B. 0.1). Maximal 12 Zeichen."/>
                    </f:facet>
                    #{e.co2Emissions}
                </p:column>

            </p:dataTable>
        </h:form>

        <h:panelGroup layout="block"
                      style="text-align:center; padding:0.5em; background:#f7f2e8">
            <h:outputText value="Modul: IPWA02-01 Programmierung von industriellen Informationssystemen mit Java EE"
                          style="font-weight:bold"/>
        </h:panelGroup>

    </h:body>
</html>